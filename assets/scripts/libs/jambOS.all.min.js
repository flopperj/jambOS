var jambOS=jambOS||{version:"1.0",name:"jambOS"};jambOS.util={};jambOS.OS={};jambOS.host={};var CPU_CLOCK_INTERVAL=100;var TIMER_IRQ=0;var KEYBOARD_IRQ=1;var PROCESS_INITIATION_IRQ=2;var PROCESS_TERMINATION_IRQ=3;var CONTEXT_SWITCH_IRQ=4;var FSDD_CALL_IRQ=5;var MEMORY_BLOCK_SIZE=256;var ALLOCATABLE_MEMORY_SLOTS=3;var HEX_BASE=16;var KERNEL_MODE=0;var USER_MODE=1;var RR_SCHEDULER=0;var FCFS_SCHEDULER=1;var PRIORITY_SCHEDULER=2;var MAX_FILESIZE=60;var MBR_END_ADRESS=77;var ALLOCATABLE_TRACKS=4;var ALLOCATABLE_SECTORS=8;var ALLOCATABLE_BLOCKS=8;var OCCUPIED_BIT=0;var TRACK_BIT=1;var SECTOR_BIT=2;var BLOCK_BIT=3;var CONTENT_BIT=4;var FSDD_CREATE=0;var FSDD_READ=1;var FSDD_WRITE=2;var FSDD_DELETE=3;var FSDD_FORMAT=4;var FSDD_LIST_FILES=5;var _CPU=null;var _HardDrive=null;var _OSclock=0;var _Mode=KERNEL_MODE;var _IsOSRunning=false;var _Canvas=null;var _TaskbarCanvas=null;var _DrawingContext=null;var _TaskbarContext=null;var _DefaultFontFamily="sans";var _DefaultFontSize=13;var _FontHeightMargin=6;var _Trace=true;var _Stepover=false;var _KernelInterruptQueue=null;var _KernelBuffers=null;var _KernelInputQueue=null;var _StdIn=null;var _StdOut=null;var _Console=null;var _OsShell=null;var _IsTyping=false;var _SarcasticMode=false;var _Kernel=null;var _Control=null;var _Device=null;var _GLaDOS=null;var _CommandHistory=[];var _CurrentCommandIndex=-1;krnInterruptHandler=null;(function(){var g=Array.prototype.slice,f=function(){};var d=(function(){for(var h in {toString:1}){if(h==="toString"){return false}}return true})();var c=function(h,l,j){for(var k in l){if(k in h.prototype&&typeof h.prototype[k]==="function"&&(l[k]+"").indexOf("callSuper")>-1){h.prototype[k]=(function(m){return function(){var o=this.constructor.superclass;this.constructor.superclass=j;var n=l[m].apply(this,arguments);this.constructor.superclass=o;if(m!=="initialize"){return n}}})(k)}else{h.prototype[k]=l[k]}if(d){if(l.toString!==Object.prototype.toString){h.prototype.toString=l.toString}if(l.valueOf!==Object.prototype.valueOf){h.prototype.valueOf=l.valueOf}}}};function b(){}function a(h){var j=this.constructor.superclass.prototype[h];return(arguments.length>1)?j.apply(this,g.call(arguments,1)):j.call(this)}function e(){var l=null,k=g.call(arguments,0);if(typeof k[0]==="function"){l=k.shift()}function h(){this.initialize.apply(this,arguments)}h.superclass=l;h.subclasses=[];if(l){b.prototype=l.prototype;h.prototype=new b();l.subclasses.push(h)}for(var j=0,m=k.length;j<m;j++){c(h,k[j],l)}if(!h.prototype.initialize){h.prototype.initialize=f}h.prototype.constructor=h;h.prototype.callSuper=a;h.prototype.type=h.prototype.type?h.prototype.type:"klass";h.prototype.toString=h.prototype.toString!==null&&typeof h.prototype.toString==="function"?h.prototype.toString:function(){return"#<jambOS."+this.type.toUpperCase()+">"};h.prototype.get=function(n){return this[n]};h.prototype.set=function(n,o){if(typeof n==="object"){for(var p in n){this._set(p,n[p])}}else{if(typeof o==="function"){this._set(n,o(this.get(n)))}else{this._set(n,o)}}return this};h.prototype._set=function(n,o){this[n]=o;return this};h.prototype.setOptions=function(n){for(var o in n){this.set(o,n[o])}return this};return h}jambOS.util.createClass=e})();jambOS.util.trim=function(a){return a.replace(/^\s+ | \s+$/g,"")};jambOS.util.rot13=function(e){var d="";for(var a in e){var b=e[a];var c=0;if("abcedfghijklmABCDEFGHIJKLM".indexOf(b)>=0){c=e.charCodeAt(a)+13;d=d+String.fromCharCode(c)}else{if("nopqrstuvwxyzNOPQRSTUVWXYZ".indexOf(b)>=0){c=e.charCodeAt(a)-13;d=d+String.fromCharCode(c)}else{d=d+b}}}return d};jambOS.util.clone=function(b){var a=$.extend(true,{},b);return a};$(document).ready(function(){_Control=new jambOS.host.Control()});jambOS.host.Control=jambOS.util.createClass({initialize:function(){var a=this;_Kernel=new jambOS.OS.Kernel();_Device=new jambOS.host.Device();_Canvas=document.getElementById("display");_Canvas.width=$("#divConsole").width()-10;_TaskbarCanvas=document.createElement("canvas");_TaskbarCanvas.id="taskbar";_TaskbarCanvas.width=$("#divConsole").width()-10;_TaskbarCanvas.height=22;_TaskbarCanvas.style.zIndex=8;_TaskbarCanvas.style.position="absolute";_TaskbarCanvas.style.borderBottom="2px solid #000000";_TaskbarCanvas.style.background="#DFDBC3";$("#taskbar").append(_TaskbarCanvas);_DrawingContext=_Canvas.getContext("2d");_TaskbarContext=_TaskbarCanvas.getContext("2d");CanvasTextFunctions.enable(_DrawingContext);document.getElementById("taLog").value="";document.getElementById("btnStartOS").focus();if(typeof Glados==="function"){_GLaDOS=new Glados();_GLaDOS.init()}$("#btnStartOS").click(function(){a.startOS($(this))});$("#btnHaltOS").click(function(){a.haltOS($(this))});$("#btnReset").click(function(){a.resetOS($(this))});$("#taProgramInput").val("A9 03 8D 41 00 A9 01 8D 40 00 AC 40 00 A2 01 FF EE 40 00 AE 40 00 EC 41 00 D0 EF A9 44 8D 42 00 A9 4F 8D 43 00 A9 4E 8D 44 00 A9 45 8D 45 00 A9 00 8D 46 00 A2 02 A0 42 FF 00");$("#btnStepOver").click(function(){if(_CPU){_CPU.cycle()}});$("#registerAnalysisTabs li a, #memoryAnalysisTabs li a").click(function(b){b.preventDefault();$(this).tab("show")})},hostLog:function(e,c){if(!c){c="?"}var b=_OSclock;var a=new Date().getTime();var d="({ clock:"+b+", source:"+c+", msg:"+e+", now:"+a+" })\n";var f=document.getElementById("taLog");f.value=d+f.value},startOS:function(a){_IsOSRunning=true;a.prop("disabled",true);$("#btnHaltOS").prop("disabled",false);$("#btnReset").prop("disabled",false);document.getElementById("display").focus();_CPU=new jambOS.host.Cpu();_HardDrive=new jambOS.host.HardDrive({fileSystem:new jambOS.OS.FileSystemDriver()});_hardwareClockID=setInterval(_Device.hostClockPulse,CPU_CLOCK_INTERVAL);_Kernel.bootstrap()},haltOS:function(a){this.hostLog("emergency halt","host");this.hostLog("Attempting Kernel shutdown.","host");_Kernel.shutdown();clearInterval(_hardwareClockID);_IsOSRunning=false},resetOS:function(a){location.reload(true)}});var _hardwareClockID=-1;jambOS.host.Device=jambOS.util.createClass({hostClockPulse:function(){_OSclock++;_Kernel.onCPUClockPulse()},hostEnableKeyboardInterrupt:function(){document.addEventListener("keydown",_Device.hostOnKeypress,false)},hostDisableKeyboardInterrupt:function(){document.removeEventListener("keydown",_Device.hostOnKeypress,false)},hostOnKeypress:function(a){var c=(a.keyCode?a.keyCode:a.which);if(a.target.id==="display"){_isTyping=true;a.preventDefault();var d=new Array(c,a.shiftKey);var b=new jambOS.OS.Interrupt({irq:KEYBOARD_IRQ,params:d});_KernelInterruptQueue.enqueue(b)}}});jambOS.host.Memory=jambOS.util.createClass({size:0,storage:new Array(),type:"memory",initialize:function(b){var a=this;b||(b={});a.setOptions(b);for(var c=0;c<a.size;c++){a.write(c,0)}return this},read:function(a){return this.get("storage")[a]},write:function(a,b){this.get("storage")[a]=b},insert:function(d,c){var a=this;for(var b=0;b<c.length;b++){a.write(b+d,c[b])}_Kernel.memoryManager.updateMemoryDisplay()}});jambOS.host.Cpu=jambOS.util.createClass({pc:0,acc:0,xReg:0,yReg:0,zFlag:0,isExecuting:false,scheduler:null,initialize:function(){this.scheduler=new jambOS.OS.CPUScheduler();return this},start:function(b){var a=this;a.scheduler.set("currentProcess",b);a.set({pc:b.pc,isExecuting:true});_Kernel.trace("Switching to Kernel Mode");_MODE=0},stop:function(){var a=this;a.set({pc:0,acc:0,xReg:0,yReg:0,zFlag:0,isExecuting:false});_Kernel.processManager.updatePCBStatusDisplay(true);if(!a.scheduler.readyQueue.isEmpty()){_CPU.isExecuting=true}_Kernel.trace("Switching to User Mode");_MODE=1;$("#btnStepOver").prop("disabled",true)},cycle:function(){var d=this;_Kernel.trace("CPU cycle");_Kernel.processManager.updateCpuStatusDisplay(d);_Kernel.processManager.updatePCBStatusDisplay();if(d.pc>(MEMORY_BLOCK_SIZE*ALLOCATABLE_MEMORY_SLOTS)){d.stop();_Kernel.trapError("Invalid Operation!",false)}if(d.scheduler.currentProcess.slot===-1){if(_Kernel.memoryManager.findOpenSlot()===null){if(!d.scheduler.readyQueue.isEmpty()){var b=_Kernel.memoryManager.getProcessToRollOut();_Kernel.memoryManager.rollOutProcess(b)}else{var a;for(i in d.scheduler.residentList){if(d.scheduler.residentList[i].slot!==-1){a=i}}_Kernel.memoryManager.rollOutProcess(d.scheduler.residentList[a])}}_Kernel.memoryManager.rollInProcess(d.scheduler.currentProcess)}var e=_Kernel.memoryManager.memory.read(d.pc++).toString().toLowerCase();var c=d.getOpCode(e);if(c){$(".operation").removeClass("currentOperation");$(".address_"+(d.pc-1)).addClass("currentOperation").addClass("validOperation");c(d);if(d.scheduler.get("currentProcess")){d.scheduler.get("currentProcess").set({acc:d.acc,pc:d.pc,xReg:d.xReg,yReg:d.yReg,zFlag:d.zFlag,state:"running"})}}else{_Kernel.trace("Invalid Operation!");$(".operation").removeClass("currentOperation");$(".address_"+(d.pc-1)).addClass("currentOperation").addClass("inValidOperation");$("#pcbStatus table tbody tr.active").addClass("error").removeClass("active");d.scheduler.processCycles=d.scheduler.quantum-1;var f=d.getOpCode("00");f(d)}if(!d.scheduler.readyQueue.isEmpty()){d.scheduler.scheduleProcess()}},getOpCode:function(c){var a=this;var b={a9:a.loadAccWithConstant,ad:a.loadAccFromMemory,"8d":a.storeAccInMemory,"6d":a.addWithCarry,a2:a.loadXRegWithConstant,ae:a.loadXRegFromMemory,a0:a.loadYRegWithConstant,ac:a.loadYRegFromMemory,"00":a.breakOperation,ea:a.noOperation,ec:a.compareXReg,d0:a.branchXBytes,ee:a.incrementByteValue,ff:a.systemCall};return b[c]},loadAccWithConstant:function(a){var b=_Kernel.memoryManager.memory.read(a.pc++);a.acc=parseInt(b,HEX_BASE)},loadAccFromMemory:function(c){var e=_Kernel.memoryManager.memory.read(c.pc++);var b=_Kernel.memoryManager.memory.read(c.pc++);var d=c.scheduler.get("currentProcess");var a=parseInt((b+e),HEX_BASE)+d.base;var f=_Kernel.memoryManager.memory.read(a);if(_Kernel.memoryManager.validateAddress(a)){c.acc=parseInt(f,HEX_BASE)}},storeAccInMemory:function(c){var e=_Kernel.memoryManager.memory.read(c.pc++);var b=_Kernel.memoryManager.memory.read(c.pc++);var d=c.scheduler.get("currentProcess");var a=parseInt((b+e),HEX_BASE)+d.base;if(_Kernel.memoryManager.validateAddress(a)){var f=_Kernel.memoryManager.decimalToHex(c.acc);_Kernel.memoryManager.memory.write(a,f)}},addWithCarry:function(c){var e=_Kernel.memoryManager.memory.read(c.pc++);var b=_Kernel.memoryManager.memory.read(c.pc++);var d=c.scheduler.get("currentProcess");var a=parseInt((b+e),HEX_BASE)+d.base;var f=_Kernel.memoryManager.memory.read(a);if(_Kernel.memoryManager.validateAddress(a)){c.acc+=parseInt(f,HEX_BASE)}},loadXRegWithConstant:function(a){var b=_Kernel.memoryManager.memory.read(a.pc++);a.xReg=parseInt(b,HEX_BASE)},loadXRegFromMemory:function(c){var e=_Kernel.memoryManager.memory.read(c.pc++);var b=_Kernel.memoryManager.memory.read(c.pc++);var d=c.scheduler.get("currentProcess");var a=parseInt((b+e),HEX_BASE)+d.base;var f=_Kernel.memoryManager.memory.read(a);if(_Kernel.memoryManager.validateAddress(a)){c.xReg=parseInt(f,HEX_BASE)}},loadYRegWithConstant:function(a){a.yReg=_Kernel.memoryManager.memory.read(a.pc++)},loadYRegFromMemory:function(c){var e=_Kernel.memoryManager.memory.read(c.pc++);var b=_Kernel.memoryManager.memory.read(c.pc++);var d=c.scheduler.get("currentProcess");var a=parseInt((b+e),HEX_BASE)+d.base;var f=_Kernel.memoryManager.memory.read(a);if(_Kernel.memoryManager.validateAddress(a)){c.yReg=parseInt(f,HEX_BASE)}},noOperation:function(a){a.pc++},breakOperation:function(a){var b=a.scheduler.currentProcess;console.log("terimnated"+b.pid);_Kernel.processManager.unload(b);switch(a.scheduler.currentSchedulingAlgorithm){case RR_SCHEDULER:a.scheduler.processCycles=a.scheduler.quantum-1;break;case FCFS_SCHEDULER:a.scheduler.processCycles=MEMORY_BLOCK_SIZE-1;break;case PRIORITY_SCHEDULER:break}_Kernel.interruptHandler(PROCESS_TERMINATION_IRQ,a.scheduler.get("currentProcess"))},compareXReg:function(c){var e=_Kernel.memoryManager.memory.read(c.pc++);var b=_Kernel.memoryManager.memory.read(c.pc++);var d=c.scheduler.get("currentProcess");var a=parseInt((b+e),HEX_BASE)+d.base;var f=_Kernel.memoryManager.memory.read(a);if(_Kernel.memoryManager.validateAddress(a)){c.zFlag=(parseInt(f)===c.xReg)?1:0}},branchXBytes:function(a){if(a.zFlag===0){var b=parseInt(_Kernel.memoryManager.memory.read(a.pc++),HEX_BASE);a.pc+=b;if(a.pc>a.scheduler.get("currentProcess").limit){a.pc-=MEMORY_BLOCK_SIZE}}else{a.pc++}},incrementByteValue:function(c){var e=_Kernel.memoryManager.memory.read(c.pc++);var b=_Kernel.memoryManager.memory.read(c.pc++);var d=c.scheduler.get("currentProcess");var a=parseInt((b+e),HEX_BASE)+d.base;var g=_Kernel.memoryManager.memory.read(a);if(_Kernel.memoryManager.validateAddress(a)){var f=parseInt(g,HEX_BASE);f++;var h=_Kernel.memoryManager.decimalToHex(f);_Kernel.memoryManager.memory.write(a,h)}},systemCall:function(b){if(b.xReg===1){var f=parseInt(b.yReg).toString();for(var d=0;d<f.length;d++){_StdIn.putText(f.charAt(d))}_StdIn.advanceLine();_OsShell.putPrompt()}else{var c=b.scheduler.get("currentProcess");var a=parseInt(b.yReg,HEX_BASE)+c.base;var h=_Kernel.memoryManager.memory.read(a);var e="";var g=0;while(h!=="00"){h=_Kernel.memoryManager.memory.read(a++);g=parseInt(h,HEX_BASE);e=String.fromCharCode(g);_StdIn.putText(e)}_StdIn.advanceLine();_OsShell.putPrompt()}}});jambOS.host.HardDrive=jambOS.util.createClass({type:"harddrive",fileSystem:null,initialize:function(a){a||(a={});this.setOptions(a);if(this._canSupportLocalStorage()&&this.fileSystem){this.fileSystem.storage=localStorage;this.formatDrive()}},formatDrive:function(){this.fileSystem.storage.clear();this.fileSystem.usedFilenames=[];for(var a=0;a<ALLOCATABLE_TRACKS;a++){for(var b=0;b<ALLOCATABLE_SECTORS;b++){for(var c=0;c<ALLOCATABLE_BLOCKS;c++){this.resetTSB(a,b,c)}}}this.fileSystem.updateHardDriveDisplay()},resetTSB:function(b,c,d){var a='[0,-1,-1,-1,"'+this.fileSystem.sanitizeFileSystemValue("")+'"]';if(b===0&&c===0&&d===0){a='[1,-1,-1,-1,"'+this.fileSystem.sanitizeFileSystemValue("MBR")+'"]'}this.fileSystem.write("["+b+","+c+","+d+"]",a)},initializeTSB:function(l,a){var h=jambOS.util.clone(l);var j=this.findNextAvailableDataTSB();var c=this.fileSystem._getAddress(j);var d=this.fileSystem._getAddress(h);var k=JSON.parse(this.fileSystem.read(c));var g=k[OCCUPIED_BIT];var b=k[TRACK_BIT];var e=k[SECTOR_BIT];var f=k[BLOCK_BIT];if(g===0){g=1}this.fileSystem.usedFilenames.push({filename:a,address:d});var k="["+g+","+j.track+","+j.sector+","+j.block+',"'+this.fileSystem.sanitizeFileSystemValue(a)+'"]';this.fileSystem.write(d,k);var k="["+g+","+b+","+e+","+f+',"'+this.fileSystem.sanitizeFileSystemValue("")+'"]';this.fileSystem.write(c,k)},findNextAvailableTSB:function(){var d=0;var c=[];var b=-1;for(var a in this.fileSystem.storage){var e=this.fileSystem._parseAddress(a);d=parseInt(e.track.toString()+e.sector.toString()+e.block.toString());if(d>=0&&d<=MBR_END_ADRESS){c=JSON.parse(this.fileSystem.storage[a]);b=c[0];if(b===0){return e}}}return null},findNextAvailableDataTSB:function(){var d=0;var c=[];var b=-1;for(var a in this.fileSystem.storage){var e=this.fileSystem._parseAddress(a);d=parseInt(e.track.toString()+e.sector.toString()+e.block.toString());if(d>MBR_END_ADRESS){c=JSON.parse(this.fileSystem.storage[a]);b=c[0];if(b===0){return e}}}return null},_canSupportLocalStorage:function(){try{return"localStorage" in window&&window.localStorage!==null}catch(a){return false}}});jambOS.OS.CPUScheduler=jambOS.util.createClass({processCycles:0,quantum:6,readyQueue:null,residentList:[],currentProcessID:0,currentProcess:null,previousProcess:null,currentSchedulingAlgorithm:RR_SCHEDULER,initialize:function(){this.readyQueue=new jambOS.OS.ProcessQueue()},scheduleProcess:function(){var a=this;if(_CPU.isExecuting){a.processCycles++;switch(a.get("currentSchedulingAlgorithm")){case RR_SCHEDULER:if(!a.readyQueue.isEmpty()&&a.processCycles===a.quantum){a.processCycles=0;_Kernel.interruptHandler(CONTEXT_SWITCH_IRQ)}break;case FCFS_SCHEDULER:if(!a.readyQueue.isEmpty()&&a.processCycles===MEMORY_BLOCK_SIZE){a.processCycles=0;_Kernel.interruptHandler(CONTEXT_SWITCH_IRQ)}break;case PRIORITY_SCHEDULER:if(!a.readyQueue.isEmpty()&&a.processCycles===MEMORY_BLOCK_SIZE){a.processCycles=0;_Kernel.interruptHandler(CONTEXT_SWITCH_IRQ)}break}}},switchContext:function(){var b=this;var c=b.get("currentProcess");_Kernel.trace("Switching Context");if(c.state!=="terminated"){c.set({pc:_CPU.pc,acc:_CPU.acc,xReg:_CPU.xReg,yReg:_CPU.yReg,zFlag:_CPU.zFlag,state:c.state!=="terminated"||c.state!=="in disk"?"ready":c.state})}var d=b.readyQueue.dequeue();if(d){if(c!==null&&c.state!=="terminated"){_CPU.scheduler.readyQueue.enqueue(c)}if(d.slot===-1){if(!b.readyQueue.isEmpty()&&_Kernel.memoryManager.findOpenSlot()===null){var a=_Kernel.memoryManager.getProcessToRollOut();_Kernel.memoryManager.rollOutProcess(a)}_Kernel.memoryManager.rollInProcess(d)}d.set("state","running");b.set({previousProcess:c,currentProcess:d});_Kernel.memoryManager.set("activeSlot",d.slot);_CPU.set({pc:d.pc,acc:d.acc,xReg:d.xReg,yReg:d.yReg,zFlag:d.zFlag,isExecuting:true})}}});jambOS.OS.MemoryManager=jambOS.util.createClass({memory:null,type:"memorymanager",slots:[],activeSlot:0,initialize:function(){var b=this;for(var c=0;c<ALLOCATABLE_MEMORY_SLOTS;c++){var e=c>0?b.slots[c-1].limit+1:0;var a=c>0?b.slots[c-1].limit+MEMORY_BLOCK_SIZE:MEMORY_BLOCK_SIZE-1;b.slots.push({base:e,limit:a,open:true})}var d=b.slots[b.slots.length-1].limit+1;b.set({memory:new jambOS.host.Memory({size:d})});b.updateMemoryDisplay()},allocate:function(c){var b=this;var a=c.slot;if(a>0){b.slots[a].open=false;c.set({base:b.slots[a].base,limit:b.slots[a].limit});_CPU.scheduler.set("currentProcess",c)}},deallocate:function(b){var a=this;var e=b.slot;for(var d=b.base;d<=b.limit;d++){a.memory.write(d,"00")}a.slots[e].open=true;for(var c in a.slots){if(a.slots[c].open){a.activeSlot=c;break}}a.updateMemoryDisplay()},findOpenSlot:function(){var a=this;for(var b in a.slots){if(a.slots[b].open){return b}}return null},getProcessToRollOut:function(){var a=_CPU.scheduler.readyQueue.getLastProcess();return a},rollInProcess:function(d){var b=this;var e=b.findOpenSlot();d.set({base:b.slots[e].base,limit:b.slots[e].limit,slot:e,state:"process loaded"});b.slots[e].open=false;var a="process_"+d.pid;var c=_HardDrive.fileSystem.readFile(a,false).split(/\s/);_Kernel.memoryManager.memory.insert(d.base,c);b.allocate(d);_HardDrive.fileSystem.deleteFile(a)},rollOutProcess:function(c){var a=this;var b=a.getProgramFromMemory(c);console.log(b);_HardDrive.fileSystem.createFile("process_"+c.pid);_HardDrive.fileSystem.writeFile("process_"+c.pid,b);a.slots[c.slot].open=true;a.deallocate(c);c.set({state:"in disk",slot:-1})},getProgramFromMemory:function(e){var c=this;var f=e.base;var a=f+e.programSize;var b="";for(var d=f;d<a;d++){b+=c.memory.read(d)}return b.match(/.{1,2}/g).join(" ")},validateAddress:function(a){var c=this;var b=_CPU.scheduler.get("currentProcess").slot;var d=(a<=c.slots[b].limit&&a>=c.slots[b].base);return d},updateMemoryDisplay:function(){var a=this;var c="<table class='table table-bordered'><tr>";var b=0;while(a.memory.size>b){if(b%8===0){c+="</tr><tr class='"+(a.memory.read(b)!==0?"has-value":"")+"'>";c+="<td>0x"+a.decimalToHex(b,4)+"</td>";c+="<td class='operation operation_"+a.memory.read(b)+" address_"+b+"'>"+a.memory.read(b)+"</td>"}else{c+="<td class='operation operation_"+a.memory.read(b)+" address_"+b+"'>"+a.memory.read(b)+"</td>"}b++}c+="</table>";$("#memory .content").html(c)},decimalToHex:function(c,b){var a=Number(c).toString(HEX_BASE);b=typeof(b)==="undefined"||b===null?b=2:b;while(a.length<b){a="0"+a}return a.toUpperCase()}});jambOS.OS.ProcessManager=jambOS.util.createClass({type:"processmanager",initialize:function(a){a||(a={});this.setOptions(a);return this},execute:function(a){a.set("state","ready");_Kernel.interruptHandler(PROCESS_INITIATION_IRQ,a)},load:function(g,m){if(isNaN(m)){m=0}$("#btnStepOver").prop("disabled",false);var j=_Kernel.memoryManager.get("slots");var d=_Kernel.memoryManager.get("activeSlot");if(d<ALLOCATABLE_MEMORY_SLOTS){_Kernel.memoryManager.activeSlot++;var c=j[d].base;var e=j[d].limit;var k=null;_Kernel.memoryManager.memory.insert(c,g);var h=_CPU.scheduler.currentProcessID++;var l=c;k=new jambOS.OS.ProcessControlBlock({pid:h,pc:l,base:c,limit:e,xReg:0,yReg:0,zFlag:0,slot:d,priority:m,state:"new",programSize:g.length});_StdIn.putText("Process "+h+" has been added to memory")}else{var h=_CPU.scheduler.currentProcessID++;var l=c;k=new jambOS.OS.ProcessControlBlock({pid:h,xReg:0,yReg:0,zFlag:0,slot:-1,state:"in disk",priority:m,programSize:g.length});var a="process_"+h;var f=g.join(" ");_HardDrive.fileSystem.createFile(a);if(_HardDrive.fileSystem.writeFile(a,f)){_StdIn.putText("Process "+h+" loaded to disk")}}_CPU.scheduler.set("currentProcess",k);_CPU.scheduler.residentList.push(k);_Kernel.memoryManager.allocate(k);if(_CPU.scheduler.currentSchedulingAlgorithm===PRIORITY_SCHEDULER){function b(o,n){if(o.priority<n.priority){return -1}if(o.priority>n.priority){return 1}return 0}_CPU.scheduler.residentList.sort(b);_CPU.scheduler.residentList.reverse()}return k},unload:function(c){var b=this;var a=[];$.each(_CPU.scheduler.residentList,function(){if(this.pid===c.pid){this.set("state","terminated");_Kernel.memoryManager.deallocate(this)}else{a.push(this)}});_CPU.scheduler.residentList=a;$.each(_CPU.scheduler.readyQueue.q,function(d,e){if(e.pid===c.pid){_CPU.scheduler.readyQueue.q.splice(d,1)}});if(!a.length){_CPU.scheduler.readyQueue.dequeue()}if(b.get("currentProcess")&&b.get("currentProcess").pid===c.pid){b.set("currentProcess",null)}},updateCpuStatusDisplay:function(f){var b=f.pc;var e=f.acc;var d=f.xReg;var a=parseInt(f.yReg,16);var c=f.zFlag;$("#cpuStatus .pc").text(b);$("#cpuStatus .acc").text(e);$("#cpuStatus .x-register").text(d);$("#cpuStatus .y-register").text(a);$("#cpuStatus .z-flag").text(c)},updatePCBStatusDisplay:function(b){var a=this;var d="";var f=jambOS.util.clone(_CPU.scheduler.get("currentProcess"));var e=$.map(jambOS.util.clone(_CPU.scheduler.residentList),function(h,g){return[h]});var c=(function(g){$.each(e,function(){if(this.pid===g.pid){return true}});return false})(f);if(b){e=[];$("#pcbStatus table tbody").empty().append("<tr><td colspan='6'><strong>No processes available</strong></td></tr>")}$.each(e.reverse(),function(){var n=this;var o=n.pid;var j=n.pc;var m=n.acc;var l=n.xReg;var h=parseInt(n.yReg,16);var k=n.zFlag;var g=n.state;d+="<tr class='"+(f.pid===n.pid?"active":"")+"'>\n                                <td>\n                                    "+o+"\n                                </td>\n                                <td>\n                                    "+(f.pid===n.pid?_CPU.pc:j)+"\n                                </td>\n                                <td>\n                                    "+m+"\n                                </td>\n                                <td>\n                                    "+l+"\n                                </td>\n                                <td>\n                                    "+h+"\n                                </td>\n                                <td>\n                                    "+k+"\n                                </td>\n                                <td>\n                                    "+g+"\n                                </td>\n                              </tr>";$("#pcbStatus table tbody").empty().append(d)})}});jambOS.OS.Interrupt=jambOS.util.createClass({type:"Interrupt",irq:null,params:null,initialize:function(b){var a=this;b||(b={});a.setOptions(b)}});var CanvasTextFunctions={};CanvasTextFunctions.letters={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},"$":{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},"0":{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},"1":{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},"2":{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},"3":{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},"4":{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},"5":{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},"6":{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},"7":{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},"8":{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},"9":{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},";":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}};CanvasTextFunctions.letter=function(a){return CanvasTextFunctions.letters[a]};CanvasTextFunctions.ascent=function(a,b){return b};CanvasTextFunctions.descent=function(a,b){return 7*b/25};CanvasTextFunctions.measure=function(b,e,g){var f=0;var a=g.length;for(var d=0;d<a;d++){var h=CanvasTextFunctions.letter(g.charAt(d));if(h){f+=h.width*e/25}}return f};CanvasTextFunctions.draw=function(r,d,s,q,n,m){var o=0;var k=m.length;var h=s/25;r.save();r.lineCap="round";r.lineWidth=2*h;r.strokeStyle="black";for(var g=0;g<k;g++){var l=CanvasTextFunctions.letter(m.charAt(g));if(!l){continue}r.beginPath();var f=1;var b=0;for(var e=0;e<l.points.length;e++){var p=l.points[e];if(p[0]===-1&&p[1]===-1){f=1;continue}if(f){r.moveTo(q+p[0]*h,n-p[1]*h);f=false}else{r.lineTo(q+p[0]*h,n-p[1]*h)}}r.stroke();q+=l.width*h}r.restore();return o};CanvasTextFunctions.enable=function(a){a.drawText=function(c,d,b,f,e){return CanvasTextFunctions.draw(a,c,d,b,f,e)};a.measureText=function(b,c,d){return CanvasTextFunctions.measure(b,c,d)};a.fontAscent=function(b,c){return CanvasTextFunctions.ascent(b,c)};a.fontDescent=function(b,c){return CanvasTextFunctions.descent(b,c)};a.drawTextRight=function(d,e,b,g,f){var c=CanvasTextFunctions.measure(d,e,f);return CanvasTextFunctions.draw(a,d,e,b-c,g,f)};a.drawTextCenter=function(d,e,b,g,f){var c=CanvasTextFunctions.measure(d,e,f);return CanvasTextFunctions.draw(a,d,e,b-c/2,g,f)}};jambOS.OS.Console=jambOS.util.createClass({buffer:"",currentFont:_DefaultFontFamily,currentFontSize:_DefaultFontSize,currentXPosition:0,currentYPosition:_DefaultFontSize,lastXPosition:0,lastYPosition:_DefaultFontSize,linesAdvanced:0,initialize:function(){this.clearScreen();this.resetXY();this.initTaskbar();this.initCursor()},initTaskbar:function(){var c=new Date();var b=16;var e=16;var a=200;var d=16;_TaskbarContext.font="bold 12px Arial";_TaskbarContext.fillText(c.toLocaleString(),b,e);_TaskbarContext.fillText("Status: OS is running...",a,d);window.setInterval(function(){c=new Date();var g=165;var f=20;if(_IsOSRunning){_TaskbarContext.clearRect(b,0,g,f);_TaskbarContext.fillText(c.toLocaleString(),b,e)}else{_TaskbarContext.clearRect(a,0,400,20);_TaskbarContext.fillText("Status: OS has halted",a,d)}},1000)},initCursor:function(){var a=this;window.setInterval(function(){if(!_IsTyping&&_StdIn&&$("#display").is(":focus")){_DrawingContext.drawText(_Console.currentFont,_Console.currentFontSize,_Console.currentXPosition,_Console.currentYPosition,"|");setTimeout(function(){a.clearBlinker()},500)}},1000)},clearScreen:function(){_Canvas.height=480;_DrawingContext.clearRect(0,0,_Canvas.width,_Canvas.height)},clearBlinker:function(){var c=this.currentXPosition;var b=(this.currentYPosition-this.currentFontSize)-1;var a=this.currentFontSize+(this.currentFontSize/2);_DrawingContext.clearRect(c,b,_Canvas.width,a)},resetXY:function(){this.currentXPosition=0;this.currentYPosition=this.currentFontSize+5},handleInput:function(){while(_KernelInputQueue.getSize()>0){var a=_KernelInputQueue.dequeue();if(a===String.fromCharCode(13)){_OsShell.handleInput(this.buffer);this.buffer=""}else{this.putText(a);this.buffer+=a}}},putText:function(b){if(b!==""){this.clearBlinker();_DrawingContext.drawText(this.currentFont,this.currentFontSize,this.currentXPosition,this.currentYPosition,b);if(this.currentXPosition>_Canvas.width){this.lastXPosition=this.currentXPosition;this.lastYPosition=this.currentYPosition;this.linesAdvanced+=1;this.advanceLine()}else{var a=_DrawingContext.measureText(this.currentFont,this.currentFontSize,b);this.currentXPosition+=a}}_isTyping=false},advanceLine:function(){this.clearBlinker();var e=_DrawingContext.measureText(this.currentFont,this.currentFontSize,">");this.currentXPosition=0;this.currentYPosition+=_DefaultFontSize+_FontHeightMargin;if(this.currentYPosition>_Canvas.height){var c=document.createElement("canvas");var a=c.getContext("2d");c.style.diplay="none";c.width=_Canvas.width;c.height=_Canvas.height;var d=_DrawingContext.getImageData(0,0,_Canvas.width,_Canvas.height);a.putImageData(d,0,0);d=a.getImageData(0,0,_Canvas.width,_Canvas.height);_Canvas.height+=_DefaultFontSize+_FontHeightMargin;_DrawingContext.putImageData(d,0,0);var b=$("#divConsole .canvas");b.scrollTop(b.find("canvas").height())}}});jambOS.OS.DeviceDriver=jambOS.util.createClass({version:"1.00",status:"unloaded",preemptable:false,driverEntry:null,isr:null,dpc:null});jambOS.OS.DeviceDriverKeyboard=jambOS.util.createClass(jambOS.OS.DeviceDriver,{initialize:function(){},driverEntry:function(){this.status="loaded"},isr:function(d){var p=d[0];var m=d[1];var a=((p>=48)&&(p<=57))||((p>=65)&&(p<=90))||((p>=97)&&(p<=123))||(p===32)||(p===13)||(p===8)||(p===38)||(p===40)||(p>=186)&&(p<=192)||(p>=219&&(p<=222))||p===16||p===20||p===8;if(!a){_Kernel.trapError("Oh bummer, I wish I could have had some use for that key! :(",false)}_Kernel.trace("Key code:"+p+" shifted:"+m);var h="";if(((p>=65)&&(p<=90))||((p>=97)&&(p<=123))){h=String.fromCharCode(p+32);if(m){h=String.fromCharCode(p)}_KernelInputQueue.enqueue(h)}else{if(((p>=48)&&(p<=57))||(p===32)||(p===13)||(p===8)||(p===38)||(p===40)||(p>=186)&&(p<=192)||(p>=219&&(p<=222))){h=String.fromCharCode(p);if(p===49&&m){h="!"}if(p===50&&m){h="@"}if(p===51&&m){h="#"}if(p===52&&m){h="$"}if(p===53&&m){h="%"}if(p===54&&m){h="^"}if(p===55&&m){h="&"}if(p===56&&m){h="*"}if(p===57&&m){h="("}if(p===48&&m){h=")"}if(p===186&&!m){h=";"}else{if(p===186&&m){h=":"}}if(p===187&&!m){h="="}else{if(p===187&&m){h="+"}}if(p===188&&!m){h=","}else{if(p===188&&m){h="<"}}if(p===189&&!m){h="-"}else{if(p===189&&m){h="_"}}if(p===190&&!m){h="."}else{if(p===190&&m){h=">"}}if(p===191&&!m){h="/"}else{if(p===191&&m){h="?"}}if(p===192&&!m){h="`"}else{if(p===192&&m){h="~"}}if(p===219&&!m){h="["}else{if(p===219&&m){h="{"}}if(p===220&&!m){h="\\"}else{if(p===220&&m){h="|"}}if(p===221&&!m){h="]"}else{if(p===221&&m){h="}"}}if(p===222&&!m){h="'"}else{if(p===222&&m){h='"'}}if(p===13){_Console.buffer=_Console.buffer.replace("[object object]","");if(_Console.buffer.trim()){_CommandHistory.push(_Console.buffer);_CurrentCommandIndex=_CommandHistory.length-1}_Console.linesAdvanced=0}var e="";if(p===38){var n=document.getElementById("divConsole");if(n.scrollTop!==n.scrollHeight){n.scrollTop=n.scrollHeight}if(_CurrentCommandIndex>0){_CurrentCommandIndex-=1}else{_CurrentCommandIndex=0}e=_CommandHistory[_CurrentCommandIndex];var g=_DrawingContext.measureText(_Console.currentFont,_Console.currentFontSize,">");_Console.currentXPosition=g;var k=_Console.currentXPosition;var c=(_Console.currentYPosition-_Console.currentFontSize)-1;var b=500;var o=_Console.currentFontSize+(_Console.currentFontSize/2);_DrawingContext.clearRect(k,c,b,o);if(e&&_CommandHistory.length>0){_Console.buffer=e;_StdIn.putText(e)}}else{if(p===40){var n=document.getElementById("divConsole");if(n.scrollTop!==n.scrollHeight){n.scrollTop=n.scrollHeight}if(_CurrentCommandIndex<_CommandHistory.length-1){_CurrentCommandIndex+=1}else{_CurrentCommandIndex=_CommandHistory.length-1}e=_CommandHistory[_CurrentCommandIndex];var g=_DrawingContext.measureText(_Console.currentFont,_Console.currentFontSize,">");_Console.currentXPosition=g;var k=_Console.currentXPosition;var c=(_Console.currentYPosition-_Console.currentFontSize)-1;var b=500;var o=_Console.currentFontSize+(_Console.currentFontSize/2);_DrawingContext.clearRect(k,c,b,o);if(e&&_CommandHistory.length>0){_Console.buffer=e;_StdIn.putText(e)}}}if(p===8&&_Console.buffer.length>0){_Console.clearBlinker();var f=_Console.buffer.charAt(_Console.buffer.length-1);_Console.buffer=_Console.buffer.slice(0,-1);var j=_DrawingContext.measureText(_Console.currentFont,_Console.currentFontSize,">");if(_Console.currentXPosition>j){var l=_DrawingContext.measureText(_Console.currentFont,_Console.currentFontSize,f);_Console.currentXPosition-=l;var k=_Console.currentXPosition;var c=(_Console.currentYPosition-_Console.currentFontSize)-1;var o=_Console.currentFontSize+(_Console.currentFontSize/2);_DrawingContext.clearRect(k,c,_Canvas.width,o)}if(_Console.currentXPosition<=j&&_Console.linesAdvanced>0){_Console.currentXPosition=_Console.lastXPosition;_Console.currentYPosition=_Console.lastYPosition;if(_Console.linesAdvanced>0){_Console.linesAdvanced-=1}}}else{if(p!==38&&p!==40){_KernelInputQueue.enqueue(h)}}}}}});jambOS.OS.FileSystemDriver=new jambOS.util.createClass(jambOS.OS.DeviceDriver,{type:"filesystem",usedFilenames:[],storage:null,isr:function(a,d){var b=d.filename;var c=d.fileData;switch(a){case FSDD_CREATE:if(this.createFile(b)){_StdIn.putText("File created: "+b)}else{_StdIn.putText("Sorry: Cannot create duplicate files!")}break;case FSDD_READ:this.readFile(b);break;case FSDD_WRITE:if(this.writeFile(b,c)){_StdIn.putText("Written data to: "+b)}else{_StdIn.putText('Sorry: File "'+b+'" not found!')}break;case FSDD_DELETE:if(this.deleteFile(b)){_StdIn.putText('Deleted: "'+b+'"')}else{_StdIn.putText('Sorry: File "'+b+'" not found!')}break;case FSDD_FORMAT:_HardDrive.formatDrive();break;case FSDD_LIST_FILES:this.listFiles();break}},read:function(a){return this.storage.getItem(a)},write:function(a,b){this.storage.setItem(a,b)},createFile:function(c){var b=this;var d=_HardDrive.findNextAvailableTSB();var a=this._isDuplicate(c);if(d&&!a){_HardDrive.initializeTSB(d,c);b.updateHardDriveDisplay();return true}return false},readFile:function(a,e){e=typeof e==="boolean"?e:true;var c="";var d=$.grep(this.usedFilenames,function(m){return m.filename.toLowerCase()===a.toLowerCase()})[0];if(d){var l=JSON.parse(this.read(d.address));var b=parseInt(l[TRACK_BIT]);var f=parseInt(l[SECTOR_BIT]);var g=parseInt(l[BLOCK_BIT]);var k=this._getAddress({track:b,sector:f,block:g});var h=JSON.parse(this.read(k));b=parseInt(h[TRACK_BIT]);f=parseInt(h[SECTOR_BIT]);g=parseInt(h[BLOCK_BIT]);var j=h[CONTENT_BIT];c=j.replace("-","");if(e){_StdIn.putText(j)}while(b!==-1){k=this._getAddress({track:b,sector:f,block:g});h=JSON.parse(this.read(k));b=parseInt(h[TRACK_BIT]);f=parseInt(h[SECTOR_BIT]);g=parseInt(h[BLOCK_BIT]);j=h[CONTENT_BIT];c+=j.replace(/-/gi,"");if(e){_StdIn.putText(j)}}}else{if(e){_StdIn.putText('Sorry: File "'+a+'" not found!')}}return c},writeFile:function(a,m){var p=this;var c=$.grep(this.usedFilenames,function(q){return q.filename.toLowerCase()===a.toLowerCase()})[0];if(c){var o=JSON.parse(this.read(c.address));var b=parseInt(o[TRACK_BIT]);var e=parseInt(o[SECTOR_BIT]);var g=parseInt(o[BLOCK_BIT]);var l=this._parseAddress(c.address);var d={track:l.track,sector:l.sector,block:l.block};var n=this._getAddress(d);var j=JSON.parse(this.read(n));b=parseInt(j[TRACK_BIT]);e=parseInt(j[SECTOR_BIT]);g=parseInt(j[BLOCK_BIT]);g-=1;var k=m.match(/.{1,60}/g);var f=1;var h=0;$.each(k,function(){h++;if(g<ALLOCATABLE_BLOCKS){g+=1}else{g=0;if(e<ALLOCATABLE_SECTORS){e+=1}else{e=0;if(b<ALLOCATABLE_TRACKS&&b>0){b+=1}}}n=p._getAddress({track:b,sector:e,block:g});if(h===k.length){b=-1;e=-1;g=-2}var q="["+f+","+b+","+e+","+(g+1)+',"'+p.sanitizeFileSystemValue(this)+'"]';p.write(n,q)});p.updateHardDriveDisplay();return true}return false},deleteFile:function(a){var n=this;var c=$.grep(this.usedFilenames,function(o){return o.filename.toLowerCase()===a.toLowerCase()})[0];if(c){var m=JSON.parse(this.read(c.address));var b=parseInt(m[TRACK_BIT]);var d=parseInt(m[SECTOR_BIT]);var e=parseInt(m[BLOCK_BIT]);var f=0;var h=c.address;var m="["+f+',-1,-1,-1,"'+this.sanitizeFileSystemValue("")+'"]';this.write(h,m);var l=this._getAddress({track:b,sector:d,block:e});var g=JSON.parse(this.read(l));b=parseInt(g[TRACK_BIT]);d=parseInt(g[SECTOR_BIT]);e=parseInt(g[BLOCK_BIT]);f=parseInt(g[OCCUPIED_BIT]);var j=this.getLinkedFileBlocks(l);$.each(j,function(){var o='[0,-1,-1,-1,"'+n.sanitizeFileSystemValue("")+'"]';n.write(this,o)});var k=[];$.each(this.usedFilenames,function(){if(this.filename.toLowerCase()!==a.toLowerCase()){k.push(this)}});this.usedFilenames=k;n.updateHardDriveDisplay();return true}return false},getLinkedFileBlocks:function(d){var e=[d];var g=d;while(g!=="[-1,-1,-1]"){var b=JSON.parse(this.read(g));var a=parseInt(b[TRACK_BIT]);var c=parseInt(b[SECTOR_BIT]);var f=parseInt(b[BLOCK_BIT]);var h=this._getAddress({track:a,sector:c,block:f});if(h!=="[-1,-1,-1]"){e.push(h)}g=h}return e},listFiles:function(){if(this.usedFilenames.length===0){_StdIn.putText("File System is currently empty!")}$.each(this.usedFilenames,function(){_StdIn.putText(this.filename);_StdIn.advanceLine()})},sanitizeFileSystemValue:function(c){var b=c.length;for(var a=b;a<MAX_FILESIZE;a++){c+="-"}return c},updateHardDriveDisplay:function(){$("#harddrive .content").empty();for(var a in this.storage){$("#harddrive .content").append(this.read(a)+"<br/>")}},_isDuplicate:function(a){var b=$.grep(this.usedFilenames,function(c){return c.filename.toLowerCase()===a.toLowerCase()});return b.length>0},_parseAddress:function(b){var e=b.replace(/\[|,|\]/g,"");var a=e.charAt(0);var c=e.charAt(1);var f=e.charAt(2);var d={track:parseInt(a),sector:parseInt(c),block:parseInt(f)};return d},_getAddress:function(a){return"["+a.track+","+a.sector+","+a.block+"]"}});jambOS.OS.Queue=jambOS.util.createClass({type:"readyqueue",q:new Array(),getSize:function(){return this.q.length},isEmpty:function(){return(this.q.length===0)},enqueue:function(a){this.q.push(a)},dequeue:function(){var a=null;if(!this.isEmpty()){a=this.q.shift()}return a},toString:function(){var b="";for(var a in this.q){b+="["+this.q[a]+"] "}return b}});jambOS.OS.ProcessQueue=jambOS.util.createClass(jambOS.OS.Queue,{type:"processqueue",q:[],initialize:function(a){a||(a={});this.setOptions(a)},getLastProcess:function(){return this.q[this.q.length-1]},toString:function(){var b="";for(var a in this.q){b+="{"+this.q[a].pid+"}"}return b}});jambOS.OS.SystemServices=jambOS.util.createClass({type:"systemservices",putPrompt:function(){_StdIn.putText(this.promptStr)},handleInput:function(a){_Kernel.trace("Shell Command~"+a);var d=this.parseInput(a);var g=d.command;var c=d.args;var b=0;var f=false;while(!f&&b<this.commandList.length){if(this.commandList[b].command===g){f=true;var e=this.commandList[b].behavior}else{++b}}if(f){this.execute(e,c)}else{if(this.curses.indexOf("["+jambOS.util.rot13(g)+"]")>=0){this.execute(shellCurse)}else{if(this.apologies.indexOf("["+g+"]")>=0){this.execute(shellApology)}else{this.execute(shellInvalidCommand)}}}},parseInput:function(b){var f=new jambOS.OS.UserCommand();b=jambOS.util.trim(b);b=b.toLowerCase();var e=b.split(" ");var d=e.shift();d=jambOS.util.trim(d);f.command=d;f.args=[];for(var c in e){var a=jambOS.util.trim(e[c]);if(a!==""){f.args.push(e[c])}}return f},execute:function(b,a){_StdIn.advanceLine();b(a);if(_StdIn.currentXPosition>0){_StdIn.advanceLine()}this.putPrompt()}});function shellInvalidCommand(){_StdIn.putText("Invalid Command. ");if(_SarcasticMode){_StdIn.putText("Duh. Go back to your Speak & Spell.")}else{_StdIn.putText("Type 'help' for, well... help.")}}function shellCurse(){_StdIn.putText("Oh, so that's how it's going to be, eh? Fine.");_StdIn.advanceLine();_StdIn.putText("Bitch.");_SarcasticMode=true}function shellApology(){if(_SarcasticMode){_StdIn.putText("Okay. I forgive you. This time.");_SarcasticMode=false}else{_StdIn.putText("For what?")}}jambOS.OS.ShellCommand=jambOS.util.createClass({type:"shellcommand",command:null,description:null,behavior:null,initialize:function(a){this.command=a.command;this.description=a.description;this.behavior=a.behavior;return this},execute:function(){return this.behavior()}});jambOS.OS.UserCommand=jambOS.util.createClass({command:"",args:[]});jambOS.OS.Shell=jambOS.util.createClass(jambOS.OS.SystemServices,{promptStr:">",commandList:[],curses:"[fuvg],[cvff],[shpx],[phag],[pbpxfhpxre],[zbgureshpxre],[gvgf]",apologies:"[sorry]",initialize:function(){var a=null;a=new jambOS.OS.ShellCommand({command:"date",description:"- Displays the current date and time",behavior:function(){var b=new Date();_StdIn.putText(b.toString())}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"whereami",description:"- Displays the current location",behavior:function(){var b=window.location.href;_StdIn.putText(b)}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"whoisawesome",description:"- Displays emotiocon of person",behavior:function(){_StdIn.putText("YOU ARE!!!!! d(*_*)b")}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"status",description:"<string> - Sets status message on taskbar",behavior:function(b){_TaskbarContext.font="bold 12px Arial";if(b.length>0){_TaskbarContext.clearRect(165,0,400,20);_TaskbarContext.fillText("Status: "+b.join(" "),200,16)}else{_TaskbarContext.clearRect(165,0,400,20);_TaskbarContext.fillText("Status: OS is running...",200,16);_StdIn.putText("Usage: status <String> - Sets status message on taskbar")}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"load",description:"- loads commands from the user input text area",behavior:function(b){var c=parseInt(b[0]);var d=$("#taProgramInput").val();var f=/^[0-9a-f]{2}( [0-9a-f]{2})*$/i.test(d);var e=f?_Kernel.processManager.load(d.split(/\s/),c):null;if(!d.trim()){_StdIn.putText("Please enter an input value then call the load command")}else{if(!f){_StdIn.putText("Invalid program")}}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"psod",description:"- simulates an OS error",behavior:function(){_TaskbarCanvas.style.backgroundColor="pink";$("#divConsole, #taLog, #taProgramInput, #memory .content, #cpuStatus .content").css({background:"pink"});return _Kernel.trapError("Pink screen of death!",true)}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"ver",description:"- Displays the current version data.",behavior:function(b){_StdIn.putText(jambOS.name+" version "+jambOS.version)}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"help",description:"- This is the help command. Seek help.",behavior:function(b){_StdIn.putText("Commands:");for(var c in _OsShell.commandList){_StdIn.advanceLine();_StdIn.putText("  "+_OsShell.commandList[c].command+" "+_OsShell.commandList[c].description)}_StdIn.advanceLine()}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"shutdown",description:"- Shuts down the virtual OS but leaves the underlying hardware simulation running.",behavior:function(b){_StdIn.putText("Shutting down...");_Kernel.shutdown()}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"clear",description:"- Clears the screen and resets the cursor position.",behavior:function(b){_StdIn.clearScreen();_StdIn.resetXY()}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"man",description:"<topic> - Displays the MANual page for <topic>.",behavior:function(c){if(c.length>0){var b=c[0];switch(b){case"help":_StdIn.putText("Help displays a list of (hopefully) valid commands.");break;default:_StdIn.putText("No manual entry for "+c[0]+".")}}else{_StdIn.putText("Usage: man <topic>  Please supply a topic.")}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"trace",description:"<on | off> - Turns the OS trace on or off.",behavior:function(b){if(b.length>0){var c=b[0];switch(c){case"on":if(_Trace&&_SarcasticMode){_StdIn.putText("Trace is already on, dumbass.")}else{_Trace=true;_StdIn.putText("Trace ON")}break;case"off":_Trace=false;_StdIn.putText("Trace OFF");break;default:_StdIn.putText("Invalid arguement.  Usage: trace <on | off>.")}}else{_StdIn.putText("Usage: trace <on | off>")}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"rot13",description:"<string> - Does rot13 obfuscation on <string>.",behavior:function(b){if(b.length>0){_StdIn.putText(b[0]+" = '"+jambOS.util.rot13(b[0])+"'")}else{_StdIn.putText("Usage: rot13 <string>  Please supply a string.")}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"prompt",description:"<string> - Sets the prompt.",behavior:function(b){if(b.length>0){_OsShell.promptStr=b[0]}else{_StdIn.putText("Usage: prompt <string>  Please supply a string.")}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"kill",description:"<id> - kills the specified process id",behavior:function(d){var b=parseInt(d[0]);if(!isNaN(b)){var c=$.grep(_CPU.scheduler.residentList,function(e){return e.pid===b})[0];if(c){c.set("state","terminated");_Kernel.processManager.unload(c);_StdIn.putText("Deleted process: "+c.pid)}else{_StdIn.putText("Invalid process!")}}else{_StdIn.putText("Usage: kill <int>")}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"run",description:"<id> - Runs program already in memory",behavior:function(d){var b=d[0];b=parseInt(b);var c=$.grep(_CPU.scheduler.residentList,function(e){return e.pid===b})[0];if(d[0]&&c&&!_Stepover){_Kernel.memoryManager.set("activeSlot",c.slot);_Kernel.processManager.execute(c)}else{if(d[0]&&c&&_Stepover){_StdIn.putText("stepover is ON. Use the stepover button to run program.")}else{if(d[0]&&!c){_StdIn.putText("Invalid Process ID")}else{_StdIn.putText("Usage: run <id | all> - Runs program already in memory")}}}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"runall",description:"- Runs all programs loaded in memory",behavior:function(){if(_CPU.scheduler.residentList.length>0&&!_Stepover){_CPU.scheduler.readyQueue=new jambOS.OS.ProcessQueue();$.each(_CPU.scheduler.residentList,function(){_CPU.scheduler.readyQueue.enqueue(this)});var b=_CPU.scheduler.readyQueue.dequeue();_Kernel.processManager.updatePCBStatusDisplay();_Kernel.memoryManager.set("activeSlot",b.slot);_Kernel.processManager.execute(b)}else{if(_CPU.scheduler.residentList.length>0&&_StepOver){_StdIn.putText("Please turn off the StepOver command to run all processes")}else{_StdIn.putText("There are no processes to run!")}}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"stepover",description:"<on | off> - Turns the OS stepover on or off.",behavior:function(b){if(b.length>0){var c=b[0];switch(c){case"on":if(_Stepover&&_SarcasticMode){_StdIn.putText("Stepover is already on, dumbass.")}else{_Stepover=true;_StdIn.putText("Stepover ON")}break;case"off":_Stepover=false;_StdIn.putText("Stepover OFF");break;default:_StdIn.putText("Invalid arguement.  Usage: stepover <on | off>.")}}else{_StdIn.putText("Usage: stepover <on | off>")}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"quantum",description:"<int> - Changes the scheduling quantum",behavior:function(b){var c=parseInt(b[0]);if(b.length>0&&!isNaN(c)){_CPU.scheduler.set("quantum",c);_StdIn.putText("Scheduling quantum set to: "+c)}else{_StdIn.putText("Usage: quantum <int>")}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"residentlist",description:"- Displays the pids of all active processes",behavior:function(){var c=_CPU.scheduler.residentList;if(c.length){var b="";$.each(c,function(){b+="["+this.pid+"]"});_StdIn.putText(b)}else{_StdIn.putText("No active processes available!")}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"create",description:"<filename> - creates file in memory",behavior:function(c){var b=c[0];if(b){var d={filename:b,fileData:null};_Kernel.interruptHandler(FSDD_CALL_IRQ,[FSDD_CREATE,d])}else{_StdIn.putText("Usage: create <filename>")}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"read",description:"<filename> - reads file in memory",behavior:function(c){var b=c[0];if(b){var d={filename:b,fileData:null};_Kernel.interruptHandler(FSDD_CALL_IRQ,[FSDD_READ,d])}else{_StdIn.putText("Usag: read <filename>")}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"write",description:"<filename>  'data' - writes data to file in memory",behavior:function(c){var b=c.shift();var g=c.join(" ");var e=g[0];var d=g[g.length-1];if(g.length>0&&b&&(e==='"'||e==="'")&&(d==='"'||d==="'")){g=g.substr(1);g=g.substr(0,g.length-1);var f={filename:b,fileData:g};_Kernel.interruptHandler(FSDD_CALL_IRQ,[FSDD_WRITE,f])}else{_StdIn.putText('Usage: write <filename> "data"')}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"delete",description:"<filename> - deletes file from memory",behavior:function(c){var b=c[0];if(b){var d={filename:b,fileData:null};_Kernel.interruptHandler(FSDD_CALL_IRQ,[FSDD_DELETE,d])}else{_StdIn.putText("Usage: delete <filename>")}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"format",description:"- Initializes all blocks in all sectors",behavior:function(){var b={filename:null,fileData:null};_Kernel.interruptHandler(FSDD_CALL_IRQ,[FSDD_FORMAT,b]);_StdIn.putText("HD format complete!")}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"ls",description:"- Lists all files currently stored on the disk",behavior:function(){var b={filename:null,fileData:null};_Kernel.interruptHandler(FSDD_CALL_IRQ,[FSDD_LIST_FILES,b])}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"setschedule",description:"[rr, fcfs, priority] - Sets scheduling algorithm",behavior:function(c){var b=c[0];switch(b){case"rr":_CPU.scheduler.set("currentSchedulingAlgorithm",RR_SCHEDULER);_StdIn.putText("Scheduling Algorithm: Round Robin");break;case"fcfs":_CPU.scheduler.set("currentSchedulingAlgorithm",FCFS_SCHEDULER);_StdIn.putText("Scheduling Algorithm: First Come First Served");break;case"priority":_CPU.scheduler.set("currentSchedulingAlgorithm",PRIORITY_SCHEDULER);_StdIn.putText("Scheduling Algorithm: Priority");break;default:_StdIn.putText("Usage: setschedule [rr, fcfs, priority]");break}}});this.commandList.push(a);a=new jambOS.OS.ShellCommand({command:"getschedule",description:"- returns currently selected cpu scheduling algorithm",behavior:function(){var b=_CPU.scheduler.get("currentSchedulingAlgorithm");switch(b){case RR_SCHEDULER:_StdIn.putText("Scheduling Algorithm: Round Robin");break;case FCFS_SCHEDULER:_StdIn.putText("Scheduling Algorithm: First Come First Served");break;case PRIORITY_SCHEDULER:_StdIn.putText("Scheduling Algorithm: Priority");break}}});this.commandList.push(a);this.putPrompt()}});jambOS.OS.Kernel=jambOS.util.createClass({keyboardDriver:null,memoryManager:null,processManager:null,initialize:function(){krnInterruptHandler=this.interruptHandler;this.memoryManager=new jambOS.OS.MemoryManager();this.processManager=new jambOS.OS.ProcessManager()},bootstrap:function(){_Control.hostLog("bootstrap","host");_KernelInterruptQueue=new jambOS.OS.Queue();_KernelBuffers=new Array();_KernelInputQueue=new jambOS.OS.Queue();_Console=new jambOS.OS.Console();_StdIn=_Console;_StdOut=_Console;this.trace("Loading the keyboard device driver.");this.keyboardDriver=new jambOS.OS.DeviceDriverKeyboard();this.keyboardDriver.driverEntry();this.trace(this.keyboardDriver.status);this.trace("Enabling the interrupts.");this.enableInterupts();this.trace("Creating and Launching the shell.");_OsShell=new jambOS.OS.Shell();if(_GLaDOS){_GLaDOS.afterStartup()}},shutdown:function(){this.trace("begin shutdown OS");this.trace("Disabling the interrupts.");this.disableInterupts();this.trace("end shutdown OS")},onCPUClockPulse:function(){if(_KernelInterruptQueue.getSize()>0){var a=_KernelInterruptQueue.dequeue();this.interruptHandler(a.irq,a.params)}else{if(_CPU.isExecuting){_CPU.cycle()}else{this.trace("Idle")}}},enableInterupts:function(){_Device.hostEnableKeyboardInterrupt()},disableInterupts:function(){_Device.hostDisableKeyboardInterrupt()},interruptHandler:function(c,e){var b=_Kernel;b.trace("Handling IRQ~"+c);switch(c){case TIMER_IRQ:_Kernal.timerISR();break;case KEYBOARD_IRQ:b.keyboardDriver.isr(e);_StdIn.handleInput();break;case PROCESS_INITIATION_IRQ:b.processInitiationISR(e);break;case PROCESS_TERMINATION_IRQ:b.processTerminationISR(e);break;case CONTEXT_SWITCH_IRQ:b.contextSwitchISR(_CPU.scheduler.get("currentProcess"));break;case FSDD_CALL_IRQ:var a=e[0];var d=e[1];b.fileSystemCall(a,d);break;default:b.trapError("Invalid Interrupt Request. irq="+c+" params=["+e+"]")}},processInitiationISR:function(a){_CPU.start(a)},processTerminationISR:function(b){var a=this;_CPU.stop();a.processManager.unload(b)},contextSwitchISR:function(b){var a=this;_CPU.scheduler.switchContext(b)},fileSystemCall:function(a,b){_HardDrive.fileSystem.isr(a,b)},timerISR:function(){},trace:function(a){if(_Trace){if(a==="Idle"){if(_OSclock%10===0){_Control.hostLog(a,"OS")}}else{_Control.hostLog(a,"OS")}}},trapError:function(g,d){d=typeof d==="undefined"?true:d;_Control.hostLog("OS ERROR - TRAP: "+g);var f=_DrawingContext.measureText(_Console.currentFont,_Console.currentFontSize,">");_Console.currentXPosition=f;var e=_Console.currentXPosition;var c=(_Console.currentYPosition-_Console.currentFontSize)-1;var b=500;var a=_Console.currentFontSize+(_Console.currentFontSize/2);_DrawingContext.clearRect(e,c,b,a);_DrawingContext.fillStyle="red";_DrawingContext.font="bold 12px Arial";_DrawingContext.fillText("OS ERROR: "+g,e,_Console.currentYPosition);_Console.currentXPosition=_Canvas.width;_StdIn.advanceLine();_OsShell.putPrompt();if(d){this.shutdown()}}});jambOS.OS.ProcessControlBlock=jambOS.util.createClass({pid:0,pc:0,acc:0,xReg:0,yReg:0,zFlag:0,priority:0,slots:[],state:"new",slot:0,base:0,limit:0,programSize:0,initialize:function(a){a||(a={});this.setOptions(a)}});